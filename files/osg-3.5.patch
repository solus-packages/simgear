From 6f0c7da6ad4763bb2cf12fe953f98206052e3c22 Mon Sep 17 00:00:00 2001
From: Richard Harrison <rjh@zaretto.com>
Date: Thu, 30 Mar 2017 03:58:27 +0200
Subject: [PATCH] OSG 3.5.x support

---
 simgear/canvas/elements/CanvasText.cxx | 25 +++++++++++++++++++------
 simgear/scene/model/ModelRegistry.cxx  |  5 +++++
 2 files changed, 24 insertions(+), 6 deletions(-)

diff --git a/simgear/canvas/elements/CanvasText.cxx b/simgear/canvas/elements/CanvasText.cxx
index 6628bb4..77a9469 100644
--- a/simgear/canvas/elements/CanvasText.cxx
+++ b/simgear/canvas/elements/CanvasText.cxx
@@ -497,18 +497,31 @@ namespace canvas
               {
                 case LEFT_TO_RIGHT:
                 {
-                  osg::Vec2 delta( activefont->getKerning( previous_charcode,
-                                                           charcode,
-                                                           _kerningType ) );
+#if OSG_VERSION_LESS_THAN(3,5,2)
+                    osg::Vec2 delta(activefont->getKerning(previous_charcode,
+                        charcode,
+                        _kerningType));
+#else
+                    osg::Vec2 delta(activefont->getKerning(_fontSize,
+                        previous_charcode,
+                        charcode,
+                        _kerningType));
+#endif
                   cursor.x() += delta.x() * wr;
                   cursor.y() += delta.y() * hr;
                   break;
                 }
                 case RIGHT_TO_LEFT:
                 {
-                  osg::Vec2 delta( activefont->getKerning( charcode,
-                                                           previous_charcode,
-                                                           _kerningType ) );
+#if OSG_VERSION_LESS_THAN(3,5,2)
+                    osg::Vec2 delta(activefont->getKerning(charcode,
+                        previous_charcode,
+                        _kerningType));
+#else
+                    osg::Vec2 delta(activefont->getKerning(_fontSize, charcode,
+                        previous_charcode,
+                        _kerningType));
+#endif
                   cursor.x() -= delta.x() * wr;
                   cursor.y() -= delta.y() * hr;
                   break;
diff --git a/simgear/scene/model/ModelRegistry.cxx b/simgear/scene/model/ModelRegistry.cxx
index 9741432..a4c8ff8 100644
--- a/simgear/scene/model/ModelRegistry.cxx
+++ b/simgear/scene/model/ModelRegistry.cxx
@@ -415,7 +415,12 @@ class SGReadCallbackInstaller {
   {
     // XXX I understand why we want this, but this seems like a weird
     // place to set this option.
+#if OSG_VERSION_LESS_THAN(3,5,4)
+      //RJH - see OSG 11ddd53eb46d15903d036b594bfa3826d9e89393 - 
+      //      Removed redundent Referenced::s/getThreadSafeReferenceCounting() and associated static and env vars 
+      //      as there are now inapprorpiate and no longer supported
     Referenced::setThreadSafeReferenceCounting(true);
+#endif
 
     Registry* registry = Registry::instance();
     Options* options = new Options;
